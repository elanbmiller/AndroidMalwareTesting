#!/usr/bin/env python
import glob
import os
import subprocess
import sys
import time
import threading
import shlex
import StringIO
import multiprocessing
import subprocess as sub
from threading import Thread
from multiprocessing import Process


packageName = 'packageNameVar'

def getPackageName(apk):
	packName = os.popen("aapt dump badging " + apk + " | grep package | awk '{print $2}' | sed s/name=//g | sed s/\\'//g").read()
	packName = packName.replace('\n', '')
	return packName

def installApk(apk):
	os.system("sudo adb install " + apk)

def unInstallApk(apkPackage):
	os.system("sudo adb uninstall " + apkPackage)

def runTcpDumpAndMonkey(apkPackage):
	os.system("sudo -i tcpdump src 10.0.2.7 -vvv > /home/seed/Documents/Programs/"  + apkPackage  + ".pcap" + " & sudo -i xterm -e adb shell monkey -p " + apkPackage + " -v 500")	
#os.system("sudo -i xterm -e adb shell monkey -p " + apkPackage + " -v 500 & sudo -i tcpdump -G 4 src 10.0.2.7 -vvv > /home/seed/Documents/Programs/"  + apkPackage  + ".pcap")

for i, file in enumerate(glob.glob('*.apk')):

	#installApk(file)	
	#os.system("echo " + "*****************PACKAGE INSTALLED****************************")
	runTcpDumpAndMonkey(getPackageName(file))
	#unInstallApk(getPackageName(file))
