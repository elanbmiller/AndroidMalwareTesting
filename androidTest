#!/bin/bash

shopt -s nullglob
packageArray=(*.apk)


function getPackageName()
	{
		myResult= aapt dump badging $1 | grep package | awk '{print $2}' | sed s/name=//g | sed s/\'//g
	}

for i in "${packageArray[@]}";
	do
		:
		myResult=$(getPackageName "$i")

	echo "------------------PACKAGE INSTALLING-----------------"

	adb install $i
	echo "*****************PACKAGE INSTALLED****************************"

	(sudo -i xterm -e "tcpdump src 10.0.2.7 -vvv -c 2400 -w /home/seed/Documents/autoTcpLogs/$myResult.pcap" & sudo -i xterm -e "adb shell monkey -p $myResult -v 2500")

	echo "------------------PACKAGE UNINSTALLING-----------------"

	sudo adb uninstall $myResult
	echo "*****************PACKAGE UNINSTALLED****************************"

done
